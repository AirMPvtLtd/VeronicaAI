<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>VERONICA - AI Assistant</title>
  <!-- Add the libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
  <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #0f0f1a;
      color: #e6e6e6;
      text-align: center;
      padding: 20px;
      background-image: radial-gradient(circle at 10% 20%, #1a1a2e 0%, #0f0f1a 90%);
    }
    button {
      padding: 12px 25px;
      font-size: 16px;
      margin: 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }
    #startBtn { 
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    #stopBtn { 
      background: linear-gradient(135deg, #E53935 0%, #B71C1C 100%);
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .output {
      margin-top: 20px;
      background: rgba(30, 30, 50, 0.7);
      padding: 20px;
      border-radius: 10px;
      text-align: left;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      white-space: pre-wrap;
      min-height: 300px;
      border: 1px solid #333344;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      font-family: 'Courier New', monospace;
      line-height: 1.6;
    }
    .status-indicator {
      margin: 15px;
      font-size: 24px;
      height: 30px;
    }
    .active { 
      color: #00FF9D; 
      animation: pulse 1.5s infinite;
      text-shadow: 0 0 8px rgba(0, 255, 157, 0.7);
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    h1 {
      color: #00FF9D;
      text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
      margin-bottom: 30px;
    }
    .user-text { color: #4FC3F7; }
    .ai-text { color: #00FF9D; }
    .system-text { color: #BA68C8; font-style: italic; }
    .language-selector {
      margin: 15px;
      padding: 8px 15px;
      border-radius: 20px;
      background: #1a1a2e;
      color: white;
      border: 1px solid #333344;
    }
  </style>
</head>
<body>
  <h1>üîÆ VERONICA - AI Assistant</h1>
  <select class="language-selector" id="languageSelector">
    <option value="en-US">English</option>
    <option value="hi-IN">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
  </select><br>
  <button id="startBtn">‚ñ∂ Activate</button>
  <button id="stopBtn">‚èπ Deactivate</button>
  <div class="status-indicator" id="statusIndicator"></div>
  <div class="output" id="responseBox">> System: Ready for activation</div>

  <script>
    const API_KEY = "x4FTLzA5S3mjqJX42QYspPDuOfrLGpTJ"; // Your Mistral API key
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const responseBox = document.getElementById("responseBox");
    const statusIndicator = document.getElementById("statusIndicator");
    const languageSelector = document.getElementById("languageSelector");

    let running = false;
    let currentLanguage = "en-US";
    const assistantName = "Veronica";

    // System prompt for JARVIS-like behavior with Hindi support
    const systemPrompt = {
      "en-US": `You are ${assistantName}, an advanced AI assistant modeled after JARVIS from Iron Man. 
      Your responses should be:
      - Precise and technical
      - Professional yet slightly witty
      - Use concise bullet points when appropriate
      - Acknowledge commands with "Certainly" or "Right away"
      - Provide status updates when performing tasks
      - Sign off responses with "- ${assistantName}" when appropriate`,
      
      "hi-IN": `‡§Ü‡§™ ${assistantName} ‡§π‡•à‡§Ç, ‡§è‡§ï ‡§â‡§®‡•ç‡§®‡§§ AI ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§ú‡•ã ‡§Ü‡§Ø‡§∞‡§® ‡§Æ‡•à‡§® ‡§ï‡•á JARVIS ‡§ï‡•Ä ‡§§‡§∞‡§π ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§
      ‡§Ü‡§™‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å ‡§π‡•ã‡§®‡•Ä ‡§ö‡§æ‡§π‡§ø‡§è:
      - ‡§∏‡§ü‡•Ä‡§ï ‡§î‡§∞ ‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä
      - ‡§™‡•á‡§∂‡•á‡§µ‡§∞ ‡§™‡§∞ ‡§•‡•ã‡§°‡§º‡§æ ‡§Æ‡§ú‡§æ‡§ï‡§ø‡§Ø‡§æ
      - ‡§â‡§ö‡§ø‡§§ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§∏‡§Ç‡§ï‡•ç‡§∑‡§ø‡§™‡•ç‡§§ ‡§¨‡•Å‡§≤‡•á‡§ü ‡§™‡•â‡§á‡§Ç‡§ü‡•ç‡§∏ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç
      - ‡§Ü‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡•ã "‡§ú‡§∞‡•Ç‡§∞" ‡§Ø‡§æ "‡§§‡•Å‡§∞‡§Ç‡§§" ‡§∏‡•á ‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç
      - ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Ö‡§™‡§°‡•á‡§ü ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç
      - ‡§â‡§ö‡§ø‡§§ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•ã "- ${assistantName}" ‡§∏‡•á ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç`
    };

    function addToOutput(text, type = "system") {
      const timestamp = new Date().toLocaleTimeString();
      const prefix = type === "user" ? "üó£ You" : type === "ai" ? "ü§ñ " + assistantName : "> System";
      responseBox.innerHTML += `\n\n[${timestamp}] ${prefix}: <span class="${type}-text">${text}</span>`;
      responseBox.scrollTop = responseBox.scrollHeight;
    }

    function speakText(text, lang) {
      if (lang === "hi-IN") {
        // Use responsivevoice for better Hindi pronunciation
        responsiveVoice.speak(text, "Hindi Female", {
          rate: 0.9,
          pitch: 0.8,
          onend: () => {
            if (running) startListening();
          }
        });
      } else {
        // Use responsivevoice for English
        responsiveVoice.speak(text, "UK English Male", {
          rate: 0.9,
          pitch: 0.8,
          onend: () => {
            if (running) startListening();
          }
        });
      }
    }

    function startListening() {
      if (!running) return;
      
      statusIndicator.innerHTML = "üîÆ <span style='color:#00FF9D'>Listening...</span>";
      statusIndicator.classList.add("active");
      
      if (annyang) {
        annyang.abort();
        annyang.start({ autoRestart: false });
      }
    }

    function stopListening() {
      statusIndicator.innerHTML = "";
      statusIndicator.classList.remove("active");
      if (annyang) {
        annyang.abort();
      }
    }

    function initializeSpeechRecognition() {
      if (!annyang) {
        addToOutput("Speech recognition not supported in this browser", "system");
        return;
      }

      // Set language
      currentLanguage = languageSelector.value;
      
      // Commands for annyang (simple fallback)
      annyang.addCommands({
        '*text': function(text) {
          processUserInput(text);
        }
      });

      annyang.addCallback('result', function(phrases) {
        console.log("Heard:", phrases);
      });

      annyang.addCallback('error', function(err) {
        console.error("Speech error:", err);
        addToOutput(`Speech recognition error: ${err}`, "system");
        if (running) setTimeout(startListening, 1000);
      });

      annyang.addCallback('end', function() {
        if (running && !responsiveVoice.isPlaying()) {
          setTimeout(startListening, 500);
        }
      });
    }

    async function processUserInput(text) {
      addToOutput(text, "user");
      stopListening();

      try {
        const response = await getAIResponse(text);
        addToOutput(response, "ai");
        speakText(response, currentLanguage);
      } catch (err) {
        console.error("API error:", err);
        addToOutput(`System error: ${err.message}`, "system");
        if (running) startListening();
      }
    }

    async function getAIResponse(userInput) {
      const response = await fetch("https://api.mistral.ai/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${API_KEY}`
        },
        body: JSON.stringify({
          model: "mistral-large-latest",
          messages: [
            { role: "system", content: systemPrompt[currentLanguage] },
            { role: "user", content: userInput }
          ],
          temperature: 0.7,
        })
      });

      const data = await response.json();
      return data.choices[0].message.content;
    }

    // Start Veronica
    startBtn.addEventListener("click", async () => {
      try {
        // Request microphone permission
        await navigator.mediaDevices.getUserMedia({ audio: true });
        
        running = true;
        startBtn.disabled = true;
        stopBtn.disabled = false;
        addToOutput("Initializing Veronica systems...", "system");
        
        initializeSpeechRecognition();
        startListening();
        
        // Initialize responsivevoice
        responsiveVoice.setDefaultVoice(currentLanguage === "hi-IN" ? "Hindi Female" : "UK English Male");
        
      } catch (err) {
        console.error("Microphone error:", err);
        addToOutput(`Activation failed: ${err.message || "Microphone access denied"}`, "system");
      }
    });

    // Stop Veronica
    stopBtn.addEventListener("click", () => {
      running = false;
      stopListening();
      responsiveVoice.cancel();
      startBtn.disabled = false;
      stopBtn.disabled = true;
      addToOutput("Veronica systems deactivated.", "system");
    });

    // Language change handler
    languageSelector.addEventListener("change", () => {
      if (running) {
        addToOutput(`Language changed to ${languageSelector.value === "hi-IN" ? "Hindi" : "English"}`, "system");
        stopListening();
        currentLanguage = languageSelector.value;
        responsiveVoice.setDefaultVoice(currentLanguage === "hi-IN" ? "Hindi Female" : "UK English Male");
        startListening();
      }
    });

    // Initialize with stop button disabled
    stopBtn.disabled = true;

    // Check for annyang support
    if (!annyang) {
      addToOutput("Note: Advanced speech recognition features not available in this browser", "system");
    }
  </script>
</body>
</html>
