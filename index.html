<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>RINKU SIR - AI Assistant</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
  <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #0f0f1a;
      color: #e6e6e6;
      text-align: center;
      padding: 20px;
      background-image: radial-gradient(circle at 10% 20%, #1a1a2e 0%, #0f0f1a 90%);
    }
    button {
      padding: 12px 25px;
      font-size: 16px;
      margin: 10px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }
    #startBtn { 
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    #stopBtn { 
      background: linear-gradient(135deg, #E53935 0%, #B71C1C 100%);
      color: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .output {
      margin-top: 20px;
      background: rgba(30, 30, 50, 0.7);
      padding: 20px;
      border-radius: 10px;
      text-align: left;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      white-space: pre-wrap;
      min-height: 300px;
      border: 1px solid #333344;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      font-family: 'Courier New', monospace;
      line-height: 1.6;
    }
    .status-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 15px;
      gap: 10px;
    }
    .status-indicator {
      font-size: 24px;
      height: 30px;
    }
    .active { 
      color: #00FF9D; 
      animation: pulse 1.5s infinite;
      text-shadow: 0 0 8px rgba(0, 255, 157, 0.7);
    }
    .noise-indicator {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #333;
    }
    .noise-active {
      background: #00FF9D;
      box-shadow: 0 0 10px #00FF9D;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }
    h1 {
      color: #00FF9D;
      text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
      margin-bottom: 30px;
    }
    .user-text { color: #4FC3F7; }
    .ai-text { color: #00FF9D; }
    .system-text { color: #BA68C8; font-style: italic; }
    .language-selector {
      margin: 15px;
      padding: 8px 15px;
      border-radius: 20px;
      background: #1a1a2e;
      color: white;
      border: 1px solid #333344;
    }
  </style>
</head>
<body>
  <h1>üîÆ RINKU SIR - AI Assistant</h1>
  <select class="language-selector" id="languageSelector">
    <option value="en-US">English</option>
    <option value="hi-IN">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
  </select><br>
  <button id="startBtn">‚ñ∂ Activate</button>
  <button id="stopBtn">‚èπ Deactivate</button>
  <div class="status-container">
    <div class="status-indicator" id="statusIndicator"></div>
    <div class="noise-indicator" id="noiseIndicator"></div>
  </div>
  <div class="output" id="responseBox">> System: Ready for activation</div>

  <script>
    const API_KEY = "x4FTLzA5S3mjqJX42QYspPDuOfrLGpTJ";
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const responseBox = document.getElementById("responseBox");
    const statusIndicator = document.getElementById("statusIndicator");
    const noiseIndicator = document.getElementById("noiseIndicator");
    const languageSelector = document.getElementById("languageSelector");

    let running = false;
    let currentLanguage = "en-US";
    const assistantName = "Rinku Sir";
    let isSpeaking = false;
    let audioStream;
    let silenceTimer;
    let voiceActivityTimer;

    // System prompts
    const systemPrompt = {
      "en-US": `You are ${assistantName}, a highly intelligent AI assistant. Respond with:
      - Natural human-like responses
      - Only speak words (never read symbols or markup)
      - Use casual but respectful tone
      - Address the user as "Sir" when appropriate
      - Never read your own name or special characters`,
      
      "hi-IN": `‡§Ü‡§™ ${assistantName} ‡§π‡•à‡§Ç, ‡§è‡§ï ‡§Ö‡§§‡•ç‡§Ø‡§ß‡§ø‡§ï ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø‡§Æ‡§æ‡§® AI ‡§∏‡§π‡§æ‡§Ø‡§ï‡•§ ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å ‡§¶‡•á‡§Ç:
      - ‡§∏‡•ç‡§µ‡§æ‡§≠‡§æ‡§µ‡§ø‡§ï ‡§Æ‡§æ‡§®‡§µ ‡§ú‡•à‡§∏‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å
      - ‡§ï‡•á‡§µ‡§≤ ‡§∂‡§¨‡•ç‡§¶ ‡§¨‡•ã‡§≤‡•á‡§Ç (‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï ‡§Ø‡§æ ‡§Æ‡§æ‡§∞‡•ç‡§ï‡§Ö‡§™ ‡§® ‡§™‡§¢‡§º‡•á‡§Ç)
      - ‡§Ü‡§ï‡§∏‡•ç‡§Æ‡§ø‡§ï ‡§≤‡•á‡§ï‡§ø‡§® ‡§∏‡§Æ‡•ç‡§Æ‡§æ‡§®‡§ú‡§®‡§ï ‡§∏‡•ç‡§µ‡§∞ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç
      - ‡§â‡§™‡§Ø‡•Å‡§ï‡•ç‡§§ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•ã "‡§∏‡§∞" ‡§ï‡§π‡§ï‡§∞ ‡§∏‡§Ç‡§¨‡•ã‡§ß‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç
      - ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§µ‡§∞‡•ç‡§£ ‡§® ‡§™‡§¢‡§º‡•á‡§Ç`
    };

    function addToOutput(text, type = "system") {
      const timestamp = new Date().toLocaleTimeString();
      const prefix = type === "user" ? "üó£ You" : type === "ai" ? "ü§ñ " + assistantName : "> System";
      responseBox.innerHTML += `\n\n[${timestamp}] ${prefix}: <span class="${type}-text">${text}</span>`;
      responseBox.scrollTop = responseBox.scrollHeight;
    }

    function cleanResponse(text) {
      // Remove any symbols or markup that might be read aloud
      return text.replace(/[\[\]\(\)\{\}\<\>\*\-\+\=\_\&\^\%\$\#\@\!]/g, ' ')
                 .replace(/\s+/g, ' ')
                 .trim();
    }

    function speakText(text, lang) {
      isSpeaking = true;
      const cleanedText = cleanResponse(text);
      
      if (lang === "hi-IN") {
        responsiveVoice.speak(cleanedText, "Hindi Male", {
          rate: 0.95,
          pitch: 1.0,
          onstart: () => {
            stopVoiceRecognition();
          },
          onend: () => {
            isSpeaking = false;
            if (running) {
              setTimeout(startVoiceRecognition, 500);
            }
          }
        });
      } else {
        responsiveVoice.speak(cleanedText, "US English Male", {
          rate: 0.95,
          pitch: 1.0,
          onstart: () => {
            stopVoiceRecognition();
          },
          onend: () => {
            isSpeaking = false;
            if (running) {
              setTimeout(startVoiceRecognition, 500);
            }
          }
        });
      }
    }

    function startVoiceRecognition() {
      if (!running || isSpeaking) return;
      
      statusIndicator.innerHTML = "üîÆ <span style='color:#00FF9D'>Listening...</span>";
      statusIndicator.classList.add("active");
      
      if (annyang) {
        annyang.abort();
        annyang.start({ autoRestart: false });
        monitorVoiceActivity();
      }
    }

    function stopVoiceRecognition() {
      statusIndicator.innerHTML = "";
      statusIndicator.classList.remove("active");
      noiseIndicator.classList.remove("noise-active");
      if (annyang) {
        annyang.abort();
      }
      if (silenceTimer) clearTimeout(silenceTimer);
      if (voiceActivityTimer) clearTimeout(voiceActivityTimer);
    }

    function monitorVoiceActivity() {
      // Simulate voice activity detection
      noiseIndicator.classList.remove("noise-active");
      
      voiceActivityTimer = setTimeout(() => {
        if (running && !isSpeaking) {
          noiseIndicator.classList.add("noise-active");
          setTimeout(() => {
            noiseIndicator.classList.remove("noise-active");
          }, 1000);
        }
      }, 1500);
    }

    function initializeSpeechRecognition() {
      if (!annyang) {
        addToOutput("Advanced speech recognition unavailable", "system");
        return;
      }

      currentLanguage = languageSelector.value;
      
      annyang.addCommands({
        '*text': function(text) {
          if (isSpeaking) return; // Ignore if assistant is speaking
          processUserInput(text);
        }
      });

      annyang.addCallback('error', function(err) {
        console.error("Speech error:", err);
        if (running && !isSpeaking) {
          setTimeout(startVoiceRecognition, 1000);
        }
      });

      annyang.addCallback('end', function() {
        if (running && !isSpeaking) {
          setTimeout(startVoiceRecognition, 500);
        }
      });
    }

    async function processUserInput(text) {
      addToOutput(text, "user");
      stopVoiceRecognition();

      try {
        const response = await getAIResponse(text);
        addToOutput(response, "ai");
        speakText(response, currentLanguage);
      } catch (err) {
        console.error("API error:", err);
        addToOutput(`System error: ${err.message}`, "system");
        if (running && !isSpeaking) {
          startVoiceRecognition();
        }
      }
    }

    async function getAIResponse(userInput) {
      const response = await fetch("https://api.mistral.ai/v1/chat/completions", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${API_KEY}`
        },
        body: JSON.stringify({
          model: "mistral-large-latest",
          messages: [
            { role: "system", content: systemPrompt[currentLanguage] },
            { role: "user", content: userInput }
          ],
          temperature: 0.7,
        })
      });

      const data = await response.json();
      return data.choices[0].message.content;
    }

    // Start Assistant
    startBtn.addEventListener("click", async () => {
      try {
        audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        
        running = true;
        startBtn.disabled = true;
        stopBtn.disabled = false;
        addToOutput("Systems activated. How may I assist you today?", "system");
        
        initializeSpeechRecognition();
        startVoiceRecognition();
        
        responsiveVoice.setDefaultVoice(currentLanguage === "hi-IN" ? "Hindi Male" : "US English Male");
        
      } catch (err) {
        console.error("Activation error:", err);
        addToOutput(`Activation failed: ${err.message}`, "system");
      }
    });

    // Stop Assistant
    stopBtn.addEventListener("click", () => {
      running = false;
      isSpeaking = false;
      stopVoiceRecognition();
      responsiveVoice.cancel();
      startBtn.disabled = false;
      stopBtn.disabled = true;
      addToOutput("Systems deactivated", "system");
      
      if (audioStream) {
        audioStream.getTracks().forEach(track => track.stop());
      }
    });

    // Language change handler
    languageSelector.addEventListener("change", () => {
      if (running) {
        addToOutput(`Language set to ${languageSelector.value === "hi-IN" ? "Hindi" : "English"}`, "system");
        stopVoiceRecognition();
        currentLanguage = languageSelector.value;
        responsiveVoice.setDefaultVoice(currentLanguage === "hi-IN" ? "Hindi Male" : "US English Male");
        if (!isSpeaking) {
          startVoiceRecognition();
        }
      }
    });

    // Initialize
    stopBtn.disabled = true;

    // Check for support
    if (!annyang) {
      addToOutput("Note: For best results use Chrome/Firefox", "system");
    }
  </script>
</body>
</html>
